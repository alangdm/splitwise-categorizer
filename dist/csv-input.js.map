{"version":3,"names":["html","css","LitElement","resetCSS","sharedCSS","CSV_REGEX","CSVInput","styles","properties","csvArray","type","Array","highlighted","Boolean","reflect","render","target","_handleFiles","files","constructor","_highlight","bind","_unhighlight","_drop","connectedCallback","document","addEventListener","capture","disconnectedCallback","removeEventListener","e","preventDefault","stopPropagation","dataTransfer","fileArr","f","test","name","content","_readFile","push","event","Event","dispatchEvent","file","Promise","resolve","reject","reader","FileReader","readAsText","result","window","customElements","define"],"sourceRoot":"/source_map/","sources":["src/csv-input.js"],"sourcesContent":["import { html, css, LitElement } from \"lit\";\r\n\r\nimport { resetCSS } from \"./reset.css.js\";\r\nimport { sharedCSS } from \"./shared.css.js\";\r\n\r\nconst CSV_REGEX = /.*\\.csv$/i;\r\n\r\nclass CSVInput extends LitElement {\r\n  static get styles() {\r\n    return [\r\n      resetCSS,\r\n      sharedCSS,\r\n      css`\r\n        :host {\r\n          display: flex;\r\n          flex-flow: column wrap;\r\n          align-items: start;\r\n          gap: 0.5rem;\r\n        }\r\n\r\n        input {\r\n          position: fixed;\r\n          top: 0px;\r\n          left: 0px;\r\n          width: 4px;\r\n          height: 4px;\r\n          opacity: 0;\r\n          overflow: hidden;\r\n          border: none;\r\n          margin: 0;\r\n          padding: 0;\r\n          display: block;\r\n          visibility: visible;\r\n          pointer-events: none;\r\n        }\r\n\r\n        label {\r\n          font-weight: bold;\r\n        }\r\n\r\n        #help-text {\r\n          background-color: var(--primary-contrast-color);\r\n          width: 100%;\r\n          height: 4rem;\r\n          border: 1px solid var(--gray-9);\r\n          border-radius: 0.25rem;\r\n          padding: 0.25rem 0.5rem;\r\n        }\r\n\r\n        :host([highlighted]) #help-text,\r\n        input:focus-visible ~ #help-text {\r\n          outline: solid var(--primary-color);\r\n        }\r\n      `,\r\n    ];\r\n  }\r\n\r\n  static get properties() {\r\n    return {\r\n      csvArray: { type: Array },\r\n      highlighted: { type: Boolean, reflect: true },\r\n    };\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      <input\r\n        id=\"csv\"\r\n        type=\"file\"\r\n        multiple\r\n        accept=\"text/csv\"\r\n        @change=${({ target }) => this._handleFiles(target.files)}\r\n      />\r\n      <label for=\"csv\">Splitwise CSV</label>\r\n      <div id=\"help-text\">Drop the Splitwise CSV files here</div>\r\n    `;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n    this.csvArray = [];\r\n    this._highlight = this._highlight.bind(this);\r\n    this._unhighlight = this._unhighlight.bind(this);\r\n    this._drop = this._drop.bind(this);\r\n  }\r\n\r\n  connectedCallback() {\r\n    super.connectedCallback();\r\n    document.addEventListener(\"dragenter\", this._highlight, { capture: false });\r\n    document.addEventListener(\"dragover\", this._highlight, { capture: false });\r\n    document.addEventListener(\"dragleave\", this._unhighlight, {\r\n      capture: false,\r\n    });\r\n    document.addEventListener(\"drop\", this._unhighlight, { capture: false });\r\n    document.addEventListener(\"drop\", this._drop);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    document.removeEventListener(\"dragenter\", this._highlight);\r\n    document.removeEventListener(\"dragover\", this._highlight);\r\n    document.removeEventListener(\"dragleave\", this._unhighlight);\r\n    document.removeEventListener(\"drop\", this._unhighlight);\r\n    document.removeEventListener(\"drop\", this._drop);\r\n  }\r\n\r\n  _highlight(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.highlighted = true;\r\n  }\r\n\r\n  _unhighlight(e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    this.highlighted = false;\r\n  }\r\n\r\n  _drop(e) {\r\n    this._handleFiles(e.dataTransfer.files);\r\n  }\r\n\r\n  async _handleFiles(files) {\r\n    this.csvArray = [];\r\n    const fileArr = [...files];\r\n    for (const f of fileArr) {\r\n      if (CSV_REGEX.test(f.name)) {\r\n        const content = await this._readFile(f);\r\n        this.csvArray.push({ name: f.name, content });\r\n      }\r\n    }\r\n    const event = new Event(\"change\");\r\n    this.dispatchEvent(event);\r\n  }\r\n\r\n  _readFile(file) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.readAsText(file, \"UTF-8\");\r\n      reader.addEventListener(\"loadend\", () => resolve(reader.result));\r\n      reader.addEventListener(\"error\", reject);\r\n    });\r\n  }\r\n}\r\n\r\nwindow.customElements.define(\"csv-input\", CSVInput);\r\n"],"mappings":"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"}