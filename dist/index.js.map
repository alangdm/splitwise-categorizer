{"version":3,"names":["html","css","LitElement","isExcludedCategory","normalizeCategoryName","CATEGORIES","resetCSS","sharedCSS","getColumnIndexes","parseDescription","SplitwiseCategorizer","styles","properties","categories","type","Array","state","isCategorizing","Boolean","reflect","totals","Object","constructor","columns","paymentMethodTotals","csvArray","shadowRoot","querySelector","render","_categorize","_reset","en","items","subtotals","_parseContents","csvContents","cols","row","values","split","date","paymentMethod","description","rawCategory","category","cost","parseFloat","currency","console","error","push","csv","csvRows","content","filter","i","csvHeaders","slice","length","window","customElements","define"],"sourceRoot":"/source_map/","sources":["src/index.js"],"sourcesContent":["import { html, css, LitElement } from \"lit\";\n\nimport {\n  isExcludedCategory,\n  normalizeCategoryName,\n  CATEGORIES,\n} from \"./utils.js\";\n\nimport { resetCSS } from \"./reset.css.js\";\nimport { sharedCSS } from \"./shared.css.js\";\n\nimport \"./category-table.js\";\nimport \"./csv-input.js\";\n\nimport { getColumnIndexes, parseDescription } from \"./utils.js\";\n\nclass SplitwiseCategorizer extends LitElement {\n  static get styles() {\n    return [\n      resetCSS,\n      sharedCSS,\n      css`\n        :host {\n          height: 100%;\n          padding: 0.5rem;\n          display: grid;\n          grid-template-rows: auto 1fr;\n          gap: 1rem;\n          color: var(--gray-9);\n        }\n        /* header */\n        header {\n          display: flex;\n          flex-flow: column wrap;\n          align-items: start;\n          gap: 0.5rem;\n          padding-bottom: 1rem;\n          border-bottom: 2px solid var(--gray-5);\n        }\n      `,\n    ];\n  }\n\n  static get properties() {\n    return {\n      categories: { type: Array, state: true },\n      isCategorizing: { type: Boolean, reflect: true },\n      totals: { type: Object, state: true },\n    };\n  }\n\n  constructor() {\n    super();\n    this.isCategorizing = false;\n    this.categories = {};\n    this.columns = {};\n    this.totals = {};\n    this.paymentMethodTotals = {};\n  }\n\n  get csvArray() {\n    return this.shadowRoot.querySelector(\"csv-input\").csvArray;\n  }\n\n  render() {\n    return html`\n      <header>\n        <csv-input @change=${this._categorize}></csv-input>\n      </header>\n      <main>\n        ${this.isCategorizing\n          ? html`Categorizing...`\n          : html`<category-table\n              .categories=${this.categories}\n              .totals=${this.totals}\n              .paymentMethodTotals=${this.paymentMethodTotals}\n            ></category-table>`}\n      </main>\n    `;\n  }\n\n  _reset() {\n    this.categories = {};\n    this.totals = {};\n    this.paymentMethodTotals = {};\n    for (const { en } of CATEGORIES) {\n      this.categories[en] = {\n        items: [],\n        subtotals: {},\n      };\n    }\n  }\n\n  _parseContents(csvContents) {\n    const cols = this.columns;\n    for (const row of csvContents) {\n      const values = row.split(\",\");\n      const date = values[cols.date];\n      const { paymentMethod, description } = parseDescription(\n        values[cols.description]\n      );\n      const rawCategory = values[cols.category];\n      const cost = parseFloat(values[cols.cost]);\n      const currency = values[cols.currency];\n\n      if (isExcludedCategory(rawCategory)) {\n        // do nothing\n        continue;\n      }\n\n      const category = normalizeCategoryName(rawCategory);\n\n      if (!category) {\n        console.error(\"Couldn't find category: \", category);\n        continue;\n      }\n\n      this.categories[category].items.push({\n        date,\n        description,\n        cost,\n        currency,\n        paymentMethod,\n      });\n\n      if (!this.categories[category].subtotals[currency]) {\n        this.categories[category].subtotals[currency] = cost;\n      } else {\n        this.categories[category].subtotals[currency] += cost;\n      }\n\n      if (!this.totals[currency]) {\n        this.totals[currency] = cost;\n      } else {\n        this.totals[currency] += cost;\n      }\n\n      // payment method\n      if (!paymentMethod) {\n        continue;\n      }\n\n      if (!this.paymentMethodTotals[paymentMethod]) {\n        this.paymentMethodTotals[paymentMethod] = {};\n      }\n      if (!this.paymentMethodTotals[paymentMethod][currency]) {\n        this.paymentMethodTotals[paymentMethod][currency] = cost;\n      } else {\n        this.paymentMethodTotals[paymentMethod][currency] += cost;\n      }\n    }\n  }\n\n  _categorize() {\n    if (!this.csvArray || this.isCategorizing) {\n      // TODO error handling\n      return;\n    }\n    this.isCategorizing = true;\n    this._reset();\n\n    for (const csv of this.csvArray) {\n      const csvRows = csv.content.split(\"\\n\").filter((i) => i);\n\n      const csvHeaders = csvRows[0];\n      this.columns = getColumnIndexes(csvHeaders.split(\",\"));\n\n      const csvContents = csvRows.slice(1, csvRows.length - 1);\n\n      this._parseContents(csvContents);\n    }\n    this.isCategorizing = false;\n  }\n}\n\nwindow.customElements.define(\"splitwise-categorizer\", SplitwiseCategorizer);\n"],"mappings":"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"}