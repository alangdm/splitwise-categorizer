{"version":3,"sources":["src/index.js"],"names":["html","css","LitElement","resetCSS","sharedCSS","getColumnIndexes","SplitwiseCategorizer","styles","properties","categories","type","Array","state","isCategorizing","Boolean","reflect","totals","Object","constructor","columns","csv","shadowRoot","querySelector","render","_categorize","_parseContents","csvContents","cols","row","values","split","date","description","category","cost","parseFloat","currency","items","subtotals","push","csvRows","filter","i","csvHeaders","slice","length","window","customElements","define"],"mappings":"AAAA,SAASA,IAAT,EAAeC,GAAf,EAAoBC,UAApB,QAAsC,KAAtC;AAEA,SAASC,QAAT,QAAyB,gBAAzB;AACA,SAASC,SAAT,QAA0B,iBAA1B;AAEA,OAAO,qBAAP;AACA,OAAO,gBAAP;AAEA,SAASC,gBAAT,QAAiC,YAAjC;;AAEA,MAAMC,oBAAN,SAAmCJ,UAAnC,CAA8C;AAC3B,aAANK,MAAM,GAAG;AAClB,WAAO,CACLJ,QADK,EAELC,SAFK,EAGLH,GAAI;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OArBW,CAAP;AAuBD;;AAEoB,aAAVO,UAAU,GAAG;AACtB,WAAO;AACLC,MAAAA,UAAU,EAAE;AAAEC,QAAAA,IAAI,EAAEC,KAAR;AAAeC,QAAAA,KAAK,EAAE;AAAtB,OADP;AAELC,MAAAA,cAAc,EAAE;AAAEH,QAAAA,IAAI,EAAEI,OAAR;AAAiBC,QAAAA,OAAO,EAAE;AAA1B,OAFX;AAGLC,MAAAA,MAAM,EAAE;AAAEN,QAAAA,IAAI,EAAEO,MAAR;AAAgBL,QAAAA,KAAK,EAAE;AAAvB;AAHH,KAAP;AAKD;;AAEDM,EAAAA,WAAW,GAAG;AACZ;AACA,SAAKL,cAAL,GAAsB,KAAtB;AACA,SAAKJ,UAAL,GAAkB,EAAlB;AACA,SAAKU,OAAL,GAAe,EAAf;AACA,SAAKH,MAAL,GAAc,EAAd;AACD;;AAEM,MAAHI,GAAG,GAAG;AACR,WAAO,KAAKC,UAAL,CAAgBC,aAAhB,CAA8B,WAA9B,EAA2CF,GAAlD;AACD;;AAEDG,EAAAA,MAAM,GAAG;AACP,WAAOvB,IAAK;AAChB;AACA;AACA,uCAAuC,KAAKwB,WAAY;AACxD;AACA;AACA,UAAU,KAAKX,cAAL,GACEb,IAAK,iBADP,GAEEA,IAAK;AACjB,4BAA4B,KAAKS,UAAW;AAC5C,wBAAwB,KAAKO,MAAO;AACpC,+BAAgC;AAChC;AACA,KAbI;AAcD;;AAEDS,EAAAA,cAAc,CAACC,WAAD,EAAc;AAC1B,UAAMC,IAAI,GAAG,KAAKR,OAAlB;;AACA,SAAK,MAAMS,GAAX,IAAkBF,WAAlB,EAA+B;AAC7B,YAAMG,MAAM,GAAGD,GAAG,CAACE,KAAJ,CAAU,GAAV,CAAf;AACA,YAAMC,IAAI,GAAGF,MAAM,CAACF,IAAI,CAACI,IAAN,CAAnB;AACA,YAAMC,WAAW,GAAGH,MAAM,CAACF,IAAI,CAACK,WAAN,CAA1B;AACA,YAAMC,QAAQ,GAAGJ,MAAM,CAACF,IAAI,CAACM,QAAN,CAAvB;AACA,YAAMC,IAAI,GAAGC,UAAU,CAACN,MAAM,CAACF,IAAI,CAACO,IAAN,CAAP,CAAvB;AACA,YAAME,QAAQ,GAAGP,MAAM,CAACF,IAAI,CAACS,QAAN,CAAvB;;AAEA,UAAI,CAAC,KAAK3B,UAAL,CAAgBwB,QAAhB,CAAL,EAAgC;AAC9B,aAAKxB,UAAL,CAAgBwB,QAAhB,IAA4B;AAC1BI,UAAAA,KAAK,EAAE,EADmB;AAE1BC,UAAAA,SAAS,EAAE;AAFe,SAA5B;AAID;;AAED,WAAK7B,UAAL,CAAgBwB,QAAhB,EAA0BI,KAA1B,CAAgCE,IAAhC,CAAqC;AACnCR,QAAAA,IADmC;AAEnCC,QAAAA,WAFmC;AAGnCE,QAAAA,IAHmC;AAInCE,QAAAA;AAJmC,OAArC;;AAOA,UAAI,CAAC,KAAK3B,UAAL,CAAgBwB,QAAhB,EAA0BK,SAA1B,CAAoCF,QAApC,CAAL,EAAoD;AAClD,aAAK3B,UAAL,CAAgBwB,QAAhB,EAA0BK,SAA1B,CAAoCF,QAApC,IAAgDF,IAAhD;AACD,OAFD,MAEO;AACL,aAAKzB,UAAL,CAAgBwB,QAAhB,EAA0BK,SAA1B,CAAoCF,QAApC,KAAiDF,IAAjD;AACD;;AAED,UAAI,CAAC,KAAKlB,MAAL,CAAYoB,QAAZ,CAAL,EAA4B;AAC1B,aAAKpB,MAAL,CAAYoB,QAAZ,IAAwBF,IAAxB;AACD,OAFD,MAEO;AACL,aAAKlB,MAAL,CAAYoB,QAAZ,KAAyBF,IAAzB;AACD;AACF;AACF;;AAEDV,EAAAA,WAAW,GAAG;AACZ,QAAI,CAAC,KAAKJ,GAAN,IAAa,KAAKP,cAAtB,EAAsC;AACpC;AACA;AACD;;AACD,SAAKA,cAAL,GAAsB,IAAtB;AACA,SAAKJ,UAAL,GAAkB,EAAlB;AACA,SAAKO,MAAL,GAAc,EAAd;AAEA,UAAMwB,OAAO,GAAG,KAAKpB,GAAL,CAASU,KAAT,CAAe,IAAf,EAAqBW,MAArB,CAA6BC,CAAD,IAAOA,CAAnC,CAAhB;AAEA,UAAMC,UAAU,GAAGH,OAAO,CAAC,CAAD,CAA1B;AACA,SAAKrB,OAAL,GAAed,gBAAgB,CAACsC,UAAU,CAACb,KAAX,CAAiB,GAAjB,CAAD,CAA/B;AAEA,UAAMJ,WAAW,GAAGc,OAAO,CAACI,KAAR,CAAc,CAAd,EAAiBJ,OAAO,CAACK,MAAR,GAAiB,CAAlC,CAApB;;AAEA,SAAKpB,cAAL,CAAoBC,WAApB;;AAEA,SAAKb,cAAL,GAAsB,KAAtB;AACD;;AAzH2C;;AA4H9CiC,MAAM,CAACC,cAAP,CAAsBC,MAAtB,CAA6B,uBAA7B,EAAsD1C,oBAAtD","sourceRoot":"/source_map/","sourcesContent":["import { html, css, LitElement } from \"lit\";\n\nimport { resetCSS } from \"./reset.css.js\";\nimport { sharedCSS } from \"./shared.css.js\";\n\nimport \"./category-table.js\";\nimport \"./csv-input.js\";\n\nimport { getColumnIndexes } from \"./utils.js\";\n\nclass SplitwiseCategorizer extends LitElement {\n  static get styles() {\n    return [\n      resetCSS,\n      sharedCSS,\n      css`\n        :host {\n          height: 100%;\n          padding: 0.5rem;\n          display: grid;\n          grid-template-rows: auto 1fr;\n          gap: 1rem;\n          color: var(--gray-9);\n        }\n        /* header */\n        header {\n          display: flex;\n          flex-flow: column wrap;\n          align-items: start;\n          gap: 0.5rem;\n          padding-bottom: 1rem;\n          border-bottom: 2px solid var(--gray-5);\n        }\n      `,\n    ];\n  }\n\n  static get properties() {\n    return {\n      categories: { type: Array, state: true },\n      isCategorizing: { type: Boolean, reflect: true },\n      totals: { type: Object, state: true },\n    };\n  }\n\n  constructor() {\n    super();\n    this.isCategorizing = false;\n    this.categories = {};\n    this.columns = {};\n    this.totals = {};\n  }\n\n  get csv() {\n    return this.shadowRoot.querySelector(\"csv-input\").csv;\n  }\n\n  render() {\n    return html`\n      <header>\n        <csv-input></csv-input>\n        <button type=\"button\" @click=${this._categorize}>Categorize</button>\n      </header>\n      <main>\n        ${this.isCategorizing\n          ? html`Categorizing...`\n          : html`<category-table\n              .categories=${this.categories}\n              .totals=${this.totals}\n            ></category-table>`}\n      </main>\n    `;\n  }\n\n  _parseContents(csvContents) {\n    const cols = this.columns;\n    for (const row of csvContents) {\n      const values = row.split(\",\");\n      const date = values[cols.date];\n      const description = values[cols.description];\n      const category = values[cols.category];\n      const cost = parseFloat(values[cols.cost]);\n      const currency = values[cols.currency];\n\n      if (!this.categories[category]) {\n        this.categories[category] = {\n          items: [],\n          subtotals: {},\n        };\n      }\n\n      this.categories[category].items.push({\n        date,\n        description,\n        cost,\n        currency,\n      });\n\n      if (!this.categories[category].subtotals[currency]) {\n        this.categories[category].subtotals[currency] = cost;\n      } else {\n        this.categories[category].subtotals[currency] += cost;\n      }\n\n      if (!this.totals[currency]) {\n        this.totals[currency] = cost;\n      } else {\n        this.totals[currency] += cost;\n      }\n    }\n  }\n\n  _categorize() {\n    if (!this.csv || this.isCategorizing) {\n      // TODO error handling\n      return;\n    }\n    this.isCategorizing = true;\n    this.categories = {};\n    this.totals = {};\n\n    const csvRows = this.csv.split(\"\\n\").filter((i) => i);\n\n    const csvHeaders = csvRows[0];\n    this.columns = getColumnIndexes(csvHeaders.split(\",\"));\n\n    const csvContents = csvRows.slice(1, csvRows.length - 1);\n\n    this._parseContents(csvContents);\n\n    this.isCategorizing = false;\n  }\n}\n\nwindow.customElements.define(\"splitwise-categorizer\", SplitwiseCategorizer);\n"]}